# FIWARE-IOTA web service

[![Build Status](https://travis-ci.org/singhhp1069/FIWARE-IOTA-SERVICE.svg?branch=master)](https://travis-ci.org/singhhp1069/FIWARE-IOTA-SERVICE)
[![dependencies Status](https://img.shields.io/david/singhhp1069/FIWARE-IOTA-SERVICE)](https://img.shields.io/david/singhhp1069/FIWARE-IOTA-SERVICE)
[![devDependencies Status](https://img.shields.io/david/dev/singhhp1069/FIWARE-IOTA-SERVICE)](https://img.shields.io/david/dev/singhhp1069/FIWARE-IOTA-SERVICE)
[![Support badge](https://nexus.lab.fiware.org/repository/raw/public/badges/stackoverflow/fiware.svg)](https://stackoverflow.com/questions/tagged/fiware)
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)


# Background
This api service is builded around [FIWARE-IOTA library]()


# Docker
```sh
$ docker pull singhhp10691/fiwareiota:latest && docker run -p 4000:4000 singhhp10691/fiwareiota
```
# Build locally using Docker
```sh
$ git clone https://github.com/singhhp1069/FIWARE-IOTA-SERVICE.git && cd FIWARE-IOTA-SERVICE
$ docker build -t fiware-iota-service . && docker run -p 4000:4000 fiware-iota-service
```
#  Build locally
```sh
$ git clone https://github.com/singhhp1069/FIWARE-IOTA-SERVICE.git
$ FIWARE-IOTA-SERVICE
$ npm install
$ npm start
```

# Configuration
**config can be found in src/config/index.js**
```sh
export default {
	env: process.env.NODE_ENV || 'development',
	server: {
		port: process.env.PORT || 4000,
		provider: process.env.IOTA_PROVIDER || 'https://nodes.devnet.thetangle.org:443',
		tcpProvider: process.env.IOTA_ZMQ_PROVIDER || 'tcp://zmq.devnet.iota.org:5556'
	},
	mqtt: {
		port: process.env.MQTT_SERVER_PORT || 1883
	}
};
```
# Api End-Points

1.**Status**
----
* **URL**
  * `/status`
* **Method:**
  * `GET`
* **Header:**
  * `Content-Type:application/json`

* **Success Response:**
 ```json
{
    "appName": "IRI Devnet",
    "appVersion": "1.8.1",
    "jreAvailableProcessors": 8,
    "jreFreeMemory": 804894984,
    "jreVersion": "1.8.0_191",
    "jreMaxMemory": 10498867200,
    "jreTotalMemory": 1856323753,
    "latestMilestone": "X9FQGTJPFSVTPYLGBGYOIQTOIMKUDKVLOTLCS9HWUXXWLFCPQKKKUCESFWMYUVCQFYOOWWJSPZUI9E999",
    "latestMilestoneIndex": 1415884,
    "latestSolidSubtangleMilestone": "X9FQGTJPFSVTPYLGBGYOIQTOIMKUDKVLOTLCS9HWUXXWLFCPQKKKUCESFWMYUVCQFYOOWWJSPZUI9E999",
    "latestSolidSubtangleMilestoneIndex": 1415884,
    "milestoneStartIndex": 434527,
    "lastSnapshottedMilestoneIndex": 434525,
    "neighbors": 8,
    "packetsQueueSize": 0,
    "time": 1574863927661,
    "tips": 4285,
    "transactionsToRequest": 0,
    "features": [
        "loadBalancer",
        "snapshotPruning",
        "RemotePOW",
        "testnet"
    ],
    "coordinatorAddress": "EQQFCZBIHRHWPXKMTOLMYUYPCN9XLMJPYZVFJSAY9FQHCCLWTOLLUGKKMXYFDBOOYFBLBI9WUEILGECYM",
    "duration": 0
}
```

2.**Set Provider**
----
* **URL**
  * `/provider`
* **Method:**
  * `POST`
* **Header:**
  * `Content-Type:application/json`

* **Request Body** *
 ```json
{
	"provider": "https://nodes.devnet.thetangle.org:443"
}
 ```

* **Success Response: Status 200**

3.**Set ZMQProvider**
----
* **URL**
  * `/zmqprovider`
* **Method:**
  * `POST`
* **Header:**
  * `Content-Type:application/json`

* **Request Body** *
 ```json
{
	"provider": "tcp://zmq.devnet.iota.org:5556"
}
 ```

* **Success Response: Status 200**

4.**Send Transaction**
----
* **URL**
  * `/transaction`
* **Method:**
  * `POST`
* **Header:**
  * `Content-Type:application/json`

* **Request Body** *
 ```json
{
	"address": "ETJF9MZSDYTESOBJUANBCIYEVREVDNPNEJWEZDSBPUKTGOZKBNFD9DYQACJZW9EGQQHANBDGHJNUXTYVD",
	"seed": "GUVMYGYLYVSKJ9AOPWJXB9V9WXEBUREGEDKJUPPMUQ9SXCYFGFXACEODXUVILVBMUZUDEJFPDSRXFSGNN",
	"data": {
			"message" : "test transaction"
		}
}
 ```

* **Success Response** *
 ```json
[
    {
        "hash": "9TEIVRUMBQBIJSTCVUWGOBVGLKORFSXSXDSLDA9LDZWQMCIRDEQCLJGFWQCQID9XHLSMRGNSMZ9IZI999",
        "signatureMessageFragment": "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
        "address": "ETJF9MZSDYTESOBJUANBCIYEVREVDNPNEJWEZDSBPUKTGOZKBNFD9DYQACJZW9EGQQHANBDGHJNUXTYVD",
        "value": 0,
        "obsoleteTag": "BA9999999999999999999999999",
        "timestamp": 1574864218,
        "currentIndex": 0,
        "lastIndex": 0,
        "bundle": "GDCJCSKRKAUFEXEZUQGR9TFTD99QJUOC9XZZIUGAXUZSAQKDNKJCRLWIIVIKONKK9XZ9KVSHPCBTKYOVX",
        "trunkTransaction": "VKUMRDSQGZDGDSFNOG9KIJY9WMRJBOHEOYOU9SODGMTSMCFDJHDUQJNESQDKTPHARKURXNOBURKLRG999",
        "branchTransaction": "LJRKLGKUVNVHELUIOSFDPXIZSCKIHUGUZZNYRZVAGMNMMHTNYDCTYOKWPKALGDX9BTJVOTPIDGFS99999",
        "tag": "BA9999999999999999999999999",
        "attachmentTimestamp": 1574864219432,
        "attachmentTimestampLowerBound": 0,
        "attachmentTimestampUpperBound": 3812798742493,
        "nonce": "OGGITGZTOSZU9YPWYSZXNCZ9IGQ"
    }
]
 ```
 
 5.**Fetch Transaction**
----
* **URL**
  * `/transaction/:hash`
* **Method:**
  * `GET`
* **Header:**
  * `Content-Type:application/json`

* **Success Response** *
 ```json
[
    {
        "hash": "9TEIVRUMBQBIJSTCVUWGOBVGLKORFSXSXDSLDA9LDZWQMCIRDEQCLJGFWQCQID9XHLSMRGNSMZ9IZI999",
        "signatureMessageFragment": "999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
        "address": "ETJF9MZSDYTESOBJUANBCIYEVREVDNPNEJWEZDSBPUKTGOZKBNFD9DYQACJZW9EGQQHANBDGHJNUXTYVD",
        "value": 0,
        "obsoleteTag": "BA9999999999999999999999999",
        "timestamp": 1574864218,
        "currentIndex": 0,
        "lastIndex": 0,
        "bundle": "GDCJCSKRKAUFEXEZUQGR9TFTD99QJUOC9XZZIUGAXUZSAQKDNKJCRLWIIVIKONKK9XZ9KVSHPCBTKYOVX",
        "trunkTransaction": "VKUMRDSQGZDGDSFNOG9KIJY9WMRJBOHEOYOU9SODGMTSMCFDJHDUQJNESQDKTPHARKURXNOBURKLRG999",
        "branchTransaction": "LJRKLGKUVNVHELUIOSFDPXIZSCKIHUGUZZNYRZVAGMNMMHTNYDCTYOKWPKALGDX9BTJVOTPIDGFS99999",
        "tag": "BA9999999999999999999999999",
        "attachmentTimestamp": 1574864219432,
        "attachmentTimestampLowerBound": 0,
        "attachmentTimestampUpperBound": 3812798742493,
        "nonce": "OGGITGZTOSZU9YPWYSZXNCZ9IGQ"
    }
]
 ```
6.**Create MAM Transaction**
----
* **URL**
  * `/mam`
* **Method:**
  * `POST`
* **Header:**
  * `Content-Type:application/json`

| Param  | Type   | Description                                        |
| ------ | ------ | -------------------------------------------------- |
| data   | string | data to be transfer                                |
| mode   | string | mode could be either public or restricted          |
| secret | string | secret of the data in case of restricted mode only |

* **Request Body** *
 ```json
{
	"data": "testing",
	"mode": "restricted",
	"secret": "secret"
}
 ```

* **Success Response** *
 ```json
[
    {
        "hash": "VT9FBQHVYUFBVHNSFKWTQWUXHVFGPQBRHCNABRKUCYQMFDU9VVOIEPYNYXAJHFFKUTKZZGNVQNPFYD999",
        "signatureMessageFragment": "AZB9HBURFAWGFCA9KMBOPZTHHNWNLGESOTBFJADYBYXJOHKBWFOJGTATHHKWGSLFDLUFQVFVNI99ZAPOVCWAPWXZPCGIUFDVSJYQTNUHSC9BFBQIYRJPSWVIRAMRKFN9MDREWPXQQNUAVIZPSYAGSCLOWJYGUDSKT9JHRWUDDEFZVWBPGD9ZDBSSTLKBBQV9DMVHKMMEYLL9NICKDVDFNSXUZ9KRYDLPXLAQGDLFAA9YLGRGFFJCLRMM9KUSWSKHXNAXQOFMEUOZBOYCOYVUMJPJJLJIRZRHLBLCDNHSACXYKZJNVOASPDHAJYPOVM9DRALJVWXPJSLKXIQUNBONEMXTNOYMOYLWPAJDYEDCJGTWWCAMOOKRMFCTVIHSWOCJQIGIQGWIHAOLHZSQSVVUSXTNVFFSQYBVQWICELBKTVZESEJWEHLLBK9LVFGUJTJNENQVAKEYLVFB9OJPOXWEAQGVUVFIERF9JVDEHBHCMYOXLCBNESGPIEZAFLVHJFMLDMRXIROISSVWGZSXPOTALZWBVSGC9FJUARPHY9TASMC9QTHJHQOVVQMRXVXHFMHA9A99OXJJAIQDIDHVVQKZHFRXJNYIQMNLUJHJ9FYLDOVCGANEZERMNVUGFYFBJWWIAYNDHCCDAYMDJBJQUSFXFPYBUPPMHETZVRYHMREHKYVJA9MNFXE9GFUGBMYLKLHYQHOHYUQDMSQUQAXZBNWXHTDZLPVXLXKRBNBDGBAEYEEICRBEWRWTMWVGTWHXWKOJHFMXCVWYWURBHMAEPU9I9QPBA9RNJCQAQDMRDVGYYAVESSQCRGIQFPHQHIDWKPUZXKQJWJUT9KYGP9JCDJLSAHUBANJIRPAFVVQGOWNCQEPV9JTKZFCLELRVEIBNGKJWCLXIWDUBHPCDVMRNBICFCUNXMPSJFYBCMUCAIVCZTJCMOKYTPCKLQLJFWLPR9XITUEASHTMVHDSHPNLPHFLAGBKQI9EX9XHNAKPWNQGSDGRZBGGOXAJLWQWGSMAXVMHYJXSOLXRABASBFNRAYBV9MRDQWEUSHHUWUAGCLRBVRYW9ELQFDTJOOQ9WFXZFMEFYCTDTFEIAH9ULSIONGKFQZR9LHLISEQZCEECYVYSBBCTXMSMMGAU9TZLDFOLGWALBIHTUIFTKZACTZTTMMFBKWQDWWZRCWPABGOGKTCSXDRSXJWXYTKGTOMXAGPQIYDMOLDBYCHSLOQQODHRXGDDFEUOEKWCPPBMQYWALGZHOVKNLOOBZEEFMO9HPULEYUTJNJRWOYYHVRUKACQMJQKQOGDDZGSBYTHF9EMQNCZEEJZPLBBCXBTAMSCXWCZISAKKJJLPKOZKHTBULGGXENNDH9AJQQKDWITBB9CI9LWKAWKOEIVRRDLBEXFEGCDPWUNKAULHEMKEQXIYE99NGEBQGGPXGPZNFSPZTBYFZQCDSNTXOHNQHNWPENVWQPXICALBZXFZBUKZSIUSGLTLKSLPHJWTJLKJWRQARZIQFB9CTVTOTLBCCQVIXBTQGRETHRHNGXHGPUS9VVJLWIBXGMPLRLRNISRPXDWJ9PLZFU9OFFT9CHWQAVWUAYGYMZCNNQOYKXPIWDMYMZVWBOEZNYABUCSJPIKPIBIVYERTANFYVPICSGYTQXJKA9CLGBMCRBBHWDXVERDKYPJFZMIUGGGRNVAENXJMFCIBZZICLJVQGQVUCCCJARIXCCYJZQXGYYEO9VJVPAORMAHQRAXSNYTMBGQCCIKVFUVGLLEVDZXKNDNSVIELGCRLJRDNVOSEDLZQBFZHZMOQBRWQE9RPWCZ9ZFRQGJIEEUUAVAI9VGHZICULKPLYTDHGDQDJRATHCONNL9NFTLGOZPRP9FRZQWQGSNPRETMPZWVTTXDIG9JNKOHQVCELIPZSQDOPOYQZLPL9OTVJMWY9BQB9ZOJRGLPCVNCGZAVKXIWLLCFWA9AUVMSYWYATVYPQXLUH9IBAGHLXQPMOLC9UHDNTFLHPIEWRYJWNOJIZPFCZ99OJFESHAGXQFKEZTIHPV9PWDCAHXVPALDZJUB9HKPFDETOFKINWVKWRQNITSZEZPGYZTPFDYHWXRWOZOAOZFSGHWUZXMAHXNSDPFKXQNRLFEPYKQJCUIWYARNGOZFDTFAJYSGDMFRDX9MMLYSWGBSTVMXKIHADSBFBDDVBHU9ZR",
        "address": "ANNIDTA9NJECGUMFKQUCBELQQQVVOAPSQNSBXWYWYHOVZOAHBAXVCQQZLEKCFJCTDWKAGQVZXHAJRLOOQ",
        "value": 0,
        "obsoleteTag": "OA9999999999999999999999999",
        "timestamp": 1574862139,
        "currentIndex": 0,
        "lastIndex": 2,
        "bundle": "QJJ99VLDSHHJJXVDHPDYHLNG9DPDPIDQURPLIZAHLBBWOKIW9KD9ENXKXRJNRNUGIAU9YJUAIKGGXZ9DC",
        "trunkTransaction": "RQUFBYMEHAA9JHBQIJKTXPQZEVEWGPIKOAZYVVPTEZZYOHVNGVCLPVZAWNANWQSPVZTYAHNTPHZGEJ999",
        "branchTransaction": "HFMBCNWLPHZADUWCPYN9JEQBHGRIYJBYFEVTRQMPSHGLAGQIKEU9NPTWFESBNJFFNEVDOTZHBRVB9W999",
        "tag": "OA9999999999999999999999999",
        "attachmentTimestamp": 1574862140134,
        "attachmentTimestampLowerBound": 0,
        "attachmentTimestampUpperBound": 3812798742493,
        "nonce": "9JGG9TKDFMCUUUOIOEYXIQAUPGJ"
    }
]
 ```
 
 7.**Fetch MAM Transaction**
----
* **URL**
  * `/mam/fetch`
* **Method:**
  * `POST`
* **Header:**
  * `Content-Type:application/json`

| Param  | Type   | Description                                        |
| ------ | ------ | -------------------------------------------------- |
| hash   | string | hash to be fetched                                 |
| mode   | string | mode could be either public or restricted          |
| secret | string | secret of the data in case of restricted mode only |

* **Request Body** *
 ```json
{
	"hash": "VT9FBQHVYUFBVHNSFKWTQWUXHVFGPQBRHCNABRKUCYQMFDU9VVOIEPYNYXAJHFFKUTKZZGNVQNPFYD999",
	"mode": "restricted",
	"secret": "secret"
}
 ```

* **Success Response** *
 ```json
{
    "result": "testing"
}
 ```
